<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta property="og:image" content="https://s-v-h-test.github.io/InnerlijkeStilte//Media/stilte-bubbel.jpg" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="https://s-v-h-test.github.io/InnerlijkeStilte//Media/stilte-bubbel.jpg" />
  <title>Innerlijke Stilte Oefening</title>
  <link href="https://fonts.googleapis.com/css?family=Quicksand:400,600&display=swap" rel="stylesheet">
  <style>
    /* Fade in/out animatie voor stappen */
    .step, .intro {
      opacity: 0;
      transition: opacity 0.35s cubic-bezier(.4,0,.2,1);
      pointer-events: none;
    }
    .step.visible, .intro.visible {
      opacity: 1;
      pointer-events: auto;
      transition: opacity 0.35s cubic-bezier(.4,0,.2,1);
    }

    html, body {
      max-width: 100vw;
      overflow-x: hidden;
    }

    .intro, .step {
      box-sizing: border-box;
      max-width: 100vw;
      overflow-x: hidden;
      position: relative;
      padding-top: 56px;
      scroll-margin-bottom: 120px;
    }

    /* Logo rechtsboven in elk tekstvak */
    .frame-logo {
      position: absolute;
      top: 8px;
      right: 12px;
      width: 72px;
      height: 72px;
      opacity: 0.92;
      pointer-events: none;
      z-index: 10;
      border-radius: 50%;
      box-shadow: 0 16px 64px 0 #000a, 0 6px 24px 0 #0005;
    }
    @media (max-width: 600px) {
      .frame-logo {
        width: 48px;
        height: 48px;
        top: 4px;
        right: 4px;
      }
    }

    /* Accentknoppen */
    .accent-btn, .accent-btn:focus {
      background: linear-gradient(90deg, #ffb84d 0%, #ffd580 100%) !important;
      color: #23262b !important;
      border: 2.5px solid #ffb84d !important;
      font-size: 1.18rem !important;
      font-weight: 800 !important;
      box-shadow: 0 2px 12px #ffb84d33;
      border-radius: 18px !important;
      outline: 2px solid #fff3 !important;
      outline-offset: 2px;
      transition: background 0.18s, color 0.18s, border 0.18s, box-shadow 0.18s;
    }
    .accent-btn:hover, .accent-btn:active {
      background: linear-gradient(90deg, #ffd580 0%, #ffb84d 100%) !important;
      color: #23262b !important;
      border-color: #ffd580 !important;
      box-shadow: 0 4px 24px #ffb84d55;
    }

    /* Universele knopstijl voor ALLE knoppen */
    button, .accent-btn, .theme-switch-btn, .home-btn {
      border-radius: 18px !important;
    }

    /* Scrollbar/progress-indicator in de intro */
    .intro-scrollbar {
      position: absolute;
      left: 0; right: 0; bottom: 0;
      height: 6px;
      background: #fff2;
      border-radius: 3px;
      overflow: hidden;
      z-index: 20;
      width: 100%;
      margin: 0;
      pointer-events: none;
    }
    .intro-scrollbar .bar {
      height: 100%;
      background: linear-gradient(90deg, #ffb84d 0%, #ffd580 100%);
      width: 0%;
      border-radius: 3px;
      transition: width 0.2s cubic-bezier(.4,0,.2,1);
    }

    /* --- STIJL A (standaard) --- */
    body.theme-a, body:not(.theme-b) {
      background-image: url('Media/44BD1B5F-FA05-4B63-B358-D1FFEA9971FC.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      color: #f0f0f0;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .theme-a .overlay, body:not(.theme-b) .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: -1;
    }
    .theme-a h1, body:not(.theme-b) h1 {
      margin-top: 1rem;
      margin-bottom: 1rem;
      font-size: 1.75rem;
      color: #ffb84d;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    .theme-a .intro, .theme-a .step, body:not(.theme-b) .intro, body:not(.theme-b) .step,
    .theme-b .intro, .theme-b .step {
      background-color: rgba(44,44,44,0.8);
      color: #fff;
      padding: 1rem;
      border-radius: 18px !important;
      font-size: 1.05rem;
      margin: 1rem auto;
      border: 3px solid #ffd580 !important;
      max-width: 1200px;
      line-height: 1.4;
      backdrop-filter: blur(5px);
      text-align: left;
      position: relative;
      padding-bottom: 60px;
    }
    .theme-a .step, body:not(.theme-b) .step { display: none; }
    .theme-a h2, body:not(.theme-b) h2 {
      margin-bottom: 0.75rem;
      color: #ffb84d;
      font-size: 1.25rem;
    }
    .theme-a p, body:not(.theme-b) p {
      margin-bottom: 1rem;
      font-size: 1.05rem;
    }
    .theme-a .intro-list, body:not(.theme-b) .intro-list {
      text-align: left;
      margin: 1.2rem 0 1.2rem 1.5rem;
      padding-left: 1.2rem;
      list-style: decimal inside;
      max-width: 500px;
    }
    .theme-a .intro-list li, body:not(.theme-b) .intro-list li {
      margin-bottom: 0.5rem;
      font-size: 1.05rem;
      line-height: 1.4;
      text-align: left;
    }
    .theme-a button, body:not(.theme-b) button {
      background-color: rgba(31,31,31,0.8);
      color: #ffb84d;
      border: 2px solid #ffb84d;
      padding: 0.8rem 1.5rem;
      margin: 1rem 0 0.5rem 0;
      cursor: pointer;
      border-radius: 18px !important;
      font-size: 1.1rem;
      transition: background-color 0.2s, color 0.2s, box-shadow 0.2s;
      backdrop-filter: blur(5px);
      width: auto;
      display: inline-block;
      position: relative;
      overflow: hidden;
    }
    .theme-a button:hover:not(:disabled), body:not(.theme-b) button:hover:not(:disabled) {
      background-color: #ffb84d;
      color: #1c2733;
    }
    .theme-a button:disabled, body:not(.theme-b) button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .theme-a button.audio-progress .progress-bar, body:not(.theme-b) button.audio-progress .progress-bar {
      position: absolute;
      left: 0; top: 0; bottom: 0;
      width: 0%;
      background: linear-gradient(90deg, #ffb84d 0%, #ffd580 100%);
      opacity: 0.4;
      z-index: 0;
      transition: width 0.1s linear;
      pointer-events: none;
      border-radius: 18px !important;
    }
    .theme-a button.audio-progress span, body:not(.theme-b) button.audio-progress span {
      position: relative;
      z-index: 1;
    }
    .theme-a button[id^="play-"], body:not(.theme-b) button[id^="play-"] {
      background-color: #ffb84d;
      color: #222;
      border: 2px solid #ffb84d;
    }
    .theme-a button[id^="play-"]:hover, body:not(.theme-b) button[id^="play-"]:hover {
      background-color: #fff3cd;
      color: #b22222;
    }
    .theme-a #count-3, body:not(.theme-b) #count-3 {
      margin-left: 0.5rem;
      font-size: 0.9rem;
      color: #ccc;
    }
    .theme-a iframe, body:not(.theme-b) iframe {
      border: none;
      width: 100%;
      height: 900px;
      background-color: rgba(255,255,255,0.9);
      border-radius: 18px !important;
      box-shadow: 0 4px 8px rgba(0,0,0,0.5);
      border: 3px solid #ffd580 !important;
    }
    .theme-a .fallback, body:not(.theme-b) .fallback {
      margin-top: 1rem;
      font-size: 0.9rem;
      color: #ccc;
    }
    .theme-a .fallback a, body:not(.theme-b) .fallback a {
      color: #ffb84d;
      text-decoration: none;
    }
    .theme-a .fallback a:hover, body:not(.theme-b) .fallback a:hover {
      text-decoration: underline;
    }
    .theme-a .frame-logo, body:not(.theme-b) .frame-logo {
      box-shadow: 0 16px 64px 0 #000a, 0 6px 24px 0 #0005;
    }
    @media (max-width: 600px) {
      body.theme-a, body:not(.theme-b) {
        min-height: 100vh;
        background-attachment: scroll;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
        overscroll-behavior: contain;
      }
      .theme-a h1, body:not(.theme-b) h1 { font-size: 1.5rem; }
      .theme-a .intro, .theme-a .step, body:not(.theme-b) .intro, body:not(.theme-b) .step,
      .theme-b .intro, .theme-b .step { width: 98%; font-size: 1.05rem; margin: 0.5rem auto; padding-bottom: 60px; }
      .theme-a button, body:not(.theme-b) button { font-size: 1rem; padding: 0.7rem 1.2rem; width: 100%; }
      .theme-a iframe, body:not(.theme-b) iframe { height: 500px; }
    }

    /* --- STIJL B (zacht, speels, pastel) --- */
    body.theme-b {
      background: #fdf6ef url('Media/stilte-bubbel.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #3a3a3a;
      font-family: 'Quicksand', Arial, sans-serif;
      margin: 0;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    .theme-b .overlay { display: none; }
    .theme-b h1 {
      margin-top: 1.2rem;
      margin-bottom: 1.2rem;
      font-size: 2rem;
      color: #3a3a3a;
      text-shadow: 0 2px 8px #fff8, 0 1px 0 #fff;
      font-family: 'Quicksand', Arial, sans-serif;
      letter-spacing: 0.04em;
      text-align: center;
      font-weight: 600;
    }
    .theme-b h2 {
      margin-bottom: 0.8rem;
      color: #ffb84d;
      font-size: 1.25rem;
      font-family: 'Quicksand', Arial, sans-serif;
      letter-spacing: 0.03em;
      font-weight: 600;
    }
    .theme-b p {
      margin-bottom: 1rem;
      font-size: 1.08rem;
    }
    .theme-b .intro-list {
      text-align: left;
      margin: 1.2rem 0 1.2rem 1.5rem;
      padding-left: 1.2rem;
      list-style: decimal inside;
      max-width: 500px;
    }
    .theme-b .intro-list li {
      margin-bottom: 0.5rem;
      font-size: 1.08rem;
      line-height: 1.5;
      text-align: left;
    }
    .theme-b button {
      background: linear-gradient(90deg, #ffe0b2 0%, #ffb84d 100%);
      color: #3a3a3a;
      border: 2px solid #ffb84d;
      padding: 1rem 1.7rem;
      margin: 1.2rem 0 0.7rem 0;
      cursor: pointer;
      border-radius: 18px !important;
      font-size: 1.15rem;
      font-family: 'Quicksand', Arial, sans-serif;
      font-weight: 600;
      box-shadow: 0 2px 8px #ffb84d33;
      transition: background 0.2s, color 0.2s, box-shadow 0.2s;
      width: auto;
      display: inline-block;
      position: relative;
      overflow: hidden;
      outline: none;
    }
    .theme-b button:hover:not(:disabled) {
      background: linear-gradient(90deg, #ffb84d 0%, #ffe0b2 100%);
      color: #fff;
      box-shadow: 0 4px 16px #ffb84d55;
    }
    .theme-b button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .theme-b button.audio-progress .progress-bar {
      position: absolute;
      left: 0; top: 0; bottom: 0;
      width: 0%;
      background: linear-gradient(90deg, #ffb84d 0%, #ffe0b2 100%);
      opacity: 0.25;
      z-index: 0;
      transition: width 0.1s linear;
      pointer-events: none;
      border-radius: 18px !important;
    }
    .theme-b button.audio-progress span {
      position: relative;
      z-index: 1;
    }
    .theme-b button[id^="play-"] {
      background: linear-gradient(90deg, #ffe0b2 0%, #ffb84d 100%);
      color: #3a3a3a;
      border: 2px solid #ffb84d;
    }
    .theme-b button[id^="play-"]:hover {
      background: linear-gradient(90deg, #ffb84d 0%, #ffe0b2 100%);
      color: #fff;
    }
    .theme-b #count-3 {
      margin-left: 0.7rem;
      font-size: 1rem;
      color: #ffb84d;
    }
    .theme-b iframe {
      border: none;
      width: 100%;
      height: 900px;
      background-color: rgba(255,255,255,0.95);
      border-radius: 18px !important;
      box-shadow: 0 4px 12px #ffb84d33;
      border: 3px solid #ffd580 !important;
    }
    .theme-b .fallback {
      margin-top: 1rem;
      font-size: 0.98rem;
      color: #ffb84d;
    }
    .theme-b .fallback a {
      color: #ffb84d;
      text-decoration: underline;
    }
    .theme-b .fallback a:hover {
      text-decoration: none;
      color: #3a3a3a;
    }
    .theme-b .frame-logo {
      box-shadow: 0 16px 64px 0 #ffb84dcc, 0 6px 24px 0 #fff7;
    }
    @media (max-width: 600px) {
      .theme-b h1 { font-size: 1.3rem; }
      .theme-b .intro, .theme-b .step { width: 98%; font-size: 1.03rem; margin: 0.5rem auto; padding-bottom: 60px; }
      .theme-b button { font-size: 1rem; padding: 0.7rem 1.2rem; width: 100%; }
      .theme-b iframe { height: 500px; }
    }

    /* --- UNIVERSELE TOOLBAR: altijd wit, gecentreerd, knoppen goed uitgelijnd --- */
    .bottom-toolbar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100vw;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1.5rem;
      padding: 0.18rem 0 0.18rem 0;
      z-index: 2000;
      background: #23262b !important;
      border-top: 2px solid #111 !important;
      box-shadow: 0 -2px 16px 0 #0002 !important;
      min-height: 56px !important;
      height: 56px !important;
      flex-direction: row;
    }
    .bottom-toolbar > * {
      order: 0;
    }
    .bottom-toolbar .toolbar-btn {
      background: #fff !important;
      color: #23262b !important;
      border: 2.5px solid #fff !important;
      box-shadow: 0 2px 8px #0001 !important;
      outline: none;
      margin: 0;
      padding: 0;
      width: 74px;
      height: 52px;
      min-width: 74px;
      min-height: 52px;
      border-radius: 18px !important;
      font-family: 'Quicksand', Arial, sans-serif;
      font-size: 1.13rem;
      font-weight: 700;
      transition: background 0.18s, color 0.18s, border 0.18s, box-shadow 0.18s;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      vertical-align: middle;
      line-height: 1;
      position: relative;
    }
    .bottom-toolbar .toolbar-btn:active,
    .bottom-toolbar .toolbar-btn:hover {
      background: #f7e7c5 !important;
      color: #23262b !important;
      border-color: #ffe0b2 !important;
      box-shadow: 0 4px 16px #ffb84d33 !important;
    }
    .home-btn .home-icon {
      display: block;
      margin: auto;
      align-self: center;
      justify-self: center;
      width: 36px;
      height: 36px;
      stroke-width: 2.2;
      stroke-linecap: round;
      stroke-linejoin: round;
      stroke: #23262b !important;
      fill: none !important;
      transition: stroke 0.2s, fill 0.2s;
      background: none;
    }
    .home-btn:active .home-icon,
    .home-btn:hover .home-icon {
      stroke: #ffb84d !important;
      fill: none !important;
      filter: brightness(1.1) drop-shadow(0 2px 6px #fff8);
    }
    @media (max-width: 600px) {
      .bottom-toolbar {
        gap: 0.7rem;
        min-height: 40px !important;
        height: 40px !important;
      }
      .bottom-toolbar .toolbar-btn {
        width: 48px;
        height: 34px;
        min-width: 48px;
        min-height: 34px;
        font-size: 0.98rem;
      }
      .home-btn .home-icon { width: 22px; height: 22px; }
    }
  </style>
</head>
<body>
  <div class="overlay"></div>
  <h1>Innerlijke Stilte Oefening</h1>

  <!-- Introductie zichtbaar bij laden -->
  <div class="intro visible" id="intro" aria-live="polite">
    <p>
      Dit is een kleine makkelijke oefening van drie stappen.<br>
      Bedoeld om innerlijke rust te ervaren.<br>
      Gebruik oortjes als je dat prettig vindt.<br><br>
      Wat we gaan doen:
    </p>
    <ol class="intro-list">
      <li>Korte uitleg = alleen luisteren.</li>
      <li>Kennismaking met de Methode = luisteren en enkele woorden hardop herhalen.</li>
      <li>Oefening = oefen door mijn woorden herhalen. Doe dit 3x.</li>
    </ol>
    <p>
      Je mag de 3 oefeningen onderbreken en later oppakken. <br>
      Ik zal onthouden waar je bent gebleven.<br>
      Na 3x oefenen volgen enkele vragen om je ervaring te delen. <br>
      Het doel van deze oefening is tweeledig.<br>
      Enerzijds is het om iedereen te helpen met het vinden van innerlijke rust.<br>
      Anderzijds is het om te onderzoeken bij wie werkt het en bij wie niet.<br>
      En hoe het wordt ervaren.<br><br>
      Na de vragen kun je zelf zo vaak als je wil verder oefenen in stap 3.<br>
      Als je helemaal opnieuw wil beginnen ga dan naar het "home" onderaan.<br>
    </p>
    <button id="continue-intro" class="accent-btn">Verder</button>
    <img src="Media/Logo.png" alt="Innerlijke Stilte Oefening logo" class="frame-logo">
    <div class="intro-scrollbar"><div class="bar" id="intro-scrollbar-bar"></div></div>
  </div>

  <!-- Stap 1 -->
  <div id="step-1" class="step" aria-live="polite">
    <h2 tabindex="-1">Stap 1</h2>
    <p>Nu volgt de uitleg.<br>
      Het duurt ongeveer 1 minuut. <br>
      Luister naar wat ik te zeggen heb.<br>
    </p>
    <button id="play-1" class="audio-progress accent-btn"><span>Uitleg</span><div class="progress-bar"></div></button>
    <button id="next-1" class="accent-btn" disabled>Volgende</button>
    <audio id="audio-1" src="Media/BTN-1.mp3" preload="auto" type="audio/mpeg">
      Your browser does not support audio playback.
    </audio>
    <img src="Media/Logo.png" alt="Innerlijke Stilte Oefening logo" class="frame-logo">
  </div>

  <!-- Stap 2 -->
  <div id="step-2" class="step" aria-live="polite">
    <h2 tabindex="-1">Stap 2</h2>
    <p>In dit deel maak je kennis met de methode.<br>
      Deze is heel simpel.<br>
      Ik zal je begeleiden. <br>
      Zorg dat je op een rustige plek bent.<br>
      En dat je zachtjes tegen jezelf kunt praten.<br>
      Het wijst zichzelf.<br>
    </p>
    <button id="play-2" class="audio-progress accent-btn"><span>Methode</span><div class="progress-bar"></div></button>
    <button id="next-2" class="accent-btn" disabled>Volgende</button>
    <audio id="audio-2" src="Media/BTN-2.mp3" preload="auto" type="audio/mpeg">
      Your browser does not support audio playback.
    </audio>
    <img src="Media/Logo.png" alt="Innerlijke Stilte Oefening logo" class="frame-logo">
  </div>

  <!-- Stap 3 -->
  <div id="step-3" class="step" aria-live="polite">
    <h2 tabindex="-1">Stap 3</h2>
    <p>In de vorige stap maakte je kennis met de methode.<br>
      Misschien heb je al iets gemerkt. Misschien nog niet.<br><br>
      Je gaat nu 3x oefenen, op een rustige plek, zodat je weet of het bij jou werkt.<br>
      Ik zal je blijven begeleiden. Je hoeft enkel mijn woorden te herhalen.<br><br>
      Je mag deze 3 oefeningen spreiden over meerdere momenten.<br>
      Na 3 keer oefenen komt het vragenlijstje.<br><br>
      Daarna kun je, desgewenst, stap drie blijven herhalen zo vaak als je wil.<br>
      Mocht je op een ander tijdstip deze hele oefening vanaf het begin willen herhalen, ga dan naar het huisje rechts boven.<br>
    </p>
    <button id="play-3" class="audio-progress accent-btn"><span>Oefening</span><div class="progress-bar"></div></button><span id="count-3">Herhalingen: 0</span>
    <audio id="audio-3" src="Media/BTN-3.mp3" preload="auto" type="audio/mpeg">
      Your browser does not support audio playback.
    </audio>
    <img src="Media/Logo.png" alt="Innerlijke Stilte Oefening logo" class="frame-logo">
  </div>

  <!-- Evaluatie -->
  <div id="evaluation-step" class="step" aria-live="polite">
    <h2 tabindex="-1">Evaluatie</h2>
    <p id="text-block-4">
      Dankjewel. Je hebt nu deze oefening 3x zelf doorlopen.<br>
      Om er achter te komen bij wie dit werkt en bij wie niet, wil ik graag dat je me feedback geeft.<br>
      Als blijkt dat dit bij meerderen werkt en als dit waardevol genoeg blijkt te zijn om verder te ontwikkelen, dan zal ik een training opzetten.<br>
      In deze training zal ik je leren om de duur van deze stilte te verlengen en deze vaardigheid toe te passen op de juiste momenten.<br>
    </p>
    <p class="fallback">
      Werkt de embed niet? <a id="fallback-link" href="https://docs.google.com/forms/d/e/1FAIpQLSfirLxCseo9n8lk0mTrL5BGosLai2ymXq2DQ66Pl3kJ5bJmRw/viewform" target="_blank">Open het formulier</a>.
    </p>
    <iframe
      src="https://docs.google.com/forms/d/e/1FAIpQLSfirLxCseo9n8lk0mTrL5BGosLai2ymXq2DQ66Pl3kJ5bJmRw/viewform?embedded=true"
      width="1000" height="1200" frameborder="0" marginheight="0" marginwidth="0">
      Laden…
    </iframe>
    <img src="Media/Logo.png" alt="Innerlijke Stilte Oefening logo" class="frame-logo">
  </div>

  <!-- Universele toolbar onderaan, altijd zichtbaar, altijd wit, gecentreerd -->
  <div class="bottom-toolbar">
    <button id="theme-switch" class="toolbar-btn" title="Wissel stijl" aria-label="Wissel stijl">Stijl</button>
    <button id="reset-button" class="toolbar-btn home-btn" title="Home" aria-label="Home">
      <svg class="home-icon" viewBox="0 0 32 32" fill="none">
        <path d="M6 16L16 8L26 16" />
        <rect x="10" y="16" width="12" height="10" rx="2" />
      </svg>
    </button>
  </div>

<script>
  // --- THEMA WISSELEN OP BASIS VAN URL EN KNOP ---
  function setTheme(theme) {
    document.body.classList.remove('theme-a', 'theme-b');
    const themeSwitch = document.getElementById('theme-switch');
    if (theme === 'B') {
      document.body.classList.add('theme-b');
      themeSwitch.textContent = 'Stijl';
      themeSwitch.setAttribute('aria-label', 'Wissel naar stijl A');
      themeSwitch.setAttribute('title', 'Wissel naar stijl A');
    } else {
      document.body.classList.add('theme-a');
      themeSwitch.textContent = 'Stijl';
      themeSwitch.setAttribute('aria-label', 'Wissel naar stijl B');
      themeSwitch.setAttribute('title', 'Wissel naar stijl B');
    }
  }

  function getThemeFromUrl() {
    const params = new URLSearchParams(window.location.search);
    return params.get('theme');
  }
  function getThemeFromStorage() {
    return sessionStorage.getItem('theme');
  }
  function setThemeInStorage(theme) {
    sessionStorage.setItem('theme', theme);
  }

  // Init theme: standaard B
  let theme = getThemeFromUrl() || getThemeFromStorage() || 'B';
  setTheme(theme);

  // Theme wissel knop
  document.getElementById('theme-switch').onclick = function() {
    theme = (theme === 'A') ? 'B' : 'A';
    setTheme(theme);
    setThemeInStorage(theme);
  };

  // Reset knop (home)
  document.getElementById('reset-button').onclick = function() {
    localStorage.clear();
    location.reload();
  };

  document.addEventListener('DOMContentLoaded', function() {
    let step3Count = parseInt(localStorage.getItem('step3Count')) || 0;
    const countDisplay = document.getElementById('count-3');

    function updateCount() {
      countDisplay.textContent = 'Herhalingen: ' + step3Count;
    }

    // Fade-in/fade-out bij stapwissel + a11y focus
    let currentStep = null;
    function showStep(id) {
      // Fade out huidige
      if (currentStep) {
        const el = document.getElementById(currentStep);
        if (el) el.classList.remove('visible');
      }
      setTimeout(function() {
        document.getElementById('intro').style.display = 'none';
        document.querySelectorAll('.step').forEach(el => el.style.display = 'none');
        document.getElementById(id).style.display = 'block';
        // Fade in nieuwe
        setTimeout(function() {
          document.getElementById(id).classList.add('visible');
          // a11y: focus op eerste heading
          const heading = document.getElementById(id).querySelector('h2, h1');
          if (heading) heading.focus();
        }, 10);
        localStorage.setItem('currentStep', id);

        // Scroll het blok zó dat het hele blok boven de toolbar uitkomt
        setTimeout(function() {
          const el = document.getElementById(id);
          if (el) {
            el.scrollIntoView({behavior: 'smooth', block: 'start'});
            // Extra scroll zodat onderkant niet achter toolbar zit
            const toolbar = document.querySelector('.bottom-toolbar');
            if (toolbar) {
              const toolbarHeight = toolbar.offsetHeight || 60;
              // Nog iets verder scrollen bij intro
              const extra = id === 'intro' ? 120 : 60;
              window.scrollBy({top: -toolbarHeight - extra, left: 0, behavior: 'smooth'});
            }
          }
        }, 200);
        currentStep = id;
      }, 200);
    }

    // Init: toon alleen intro
    document.getElementById('intro').style.display = 'block';
    document.getElementById('intro').classList.add('visible');
    currentStep = 'intro';

    // Verder-knop toont stap-1 of opgeslagen stap
    document.getElementById('continue-intro').onclick = function() {
      const saved = localStorage.getItem('currentStep');
      showStep(saved && ['step-1','step-2','step-3','evaluation-step'].includes(saved) ? saved : 'step-1');
    };

    // Intro scrollbar/progress-indicator
    const intro = document.getElementById('intro');
    const introScrollbarBar = document.getElementById('intro-scrollbar-bar');
    intro.addEventListener('scroll', function() {
      const scrollTop = intro.scrollTop;
      const scrollHeight = intro.scrollHeight - intro.clientHeight;
      const percent = scrollHeight > 0 ? (scrollTop / scrollHeight) * 100 : 0;
      introScrollbarBar.style.width = percent + '%';
    });
    setTimeout(() => {
      intro.dispatchEvent(new Event('scroll'));
    }, 100);

    // AUDIO BUTTON LOGIC (PAUSE/RESUME/REPLAY)
    function setupAudioControls(audioId, btnId, nextId, defaultText) {
      const audio = document.getElementById(audioId);
      const btn = document.getElementById(btnId);
      const progressBar = btn.querySelector('.progress-bar');
      const next = nextId ? document.getElementById(nextId) : null;

      function setBtnText(state) {
        btn.querySelector('span').textContent = (
          state === 'default' ? defaultText :
          state === 'playing' ? 'Pauze' :
          state === 'paused' ? 'Verder' : 'Opnieuw'
        );
      }

      setBtnText('default');
      if (next) next.disabled = true;

      function updateProgress() {
        if (audio.duration) {
          const percent = (audio.currentTime / audio.duration) * 100;
          progressBar.style.width = percent + '%';
        } else {
          progressBar.style.width = '0%';
        }
        if (!audio.paused && !audio.ended) {
          requestAnimationFrame(updateProgress);
        }
      }

      btn.onclick = function() {
        const btnText = btn.querySelector('span').textContent.trim();
        if (audio.ended || audio.currentTime === audio.duration || btnText === 'Opnieuw') {
          audio.currentTime = 0;
          progressBar.style.width = '0%';
          setBtnText('playing');
          if (next) next.disabled = true;
          audio.play();
          requestAnimationFrame(updateProgress);
          return;
        }
        if (!audio.paused && !audio.ended) {
          audio.pause();
          setBtnText('paused');
          if (next) next.disabled = true;
          return;
        }
        if (audio.paused && !audio.ended) {
          setBtnText('playing');
          if (next) next.disabled = true;
          audio.play();
          requestAnimationFrame(updateProgress);
          return;
        }
      };

      audio.onplay = function() {
        setBtnText('playing');
        if (next) next.disabled = true;
        requestAnimationFrame(updateProgress);
      };
      audio.onpause = function() {
        if (!audio.ended) {
          setBtnText('paused');
          if (next) next.disabled = true;
        }
      };
      audio.onended = function() {
        setBtnText('ended');
        progressBar.style.width = '100%';
        if (next) next.disabled = false;
      };

      function resetBtn() {
        setBtnText('default');
        if (next) next.disabled = true;
        audio.currentTime = 0;
        progressBar.style.width = '0%';
      }
      return resetBtn;
    }

    // Stap 1
    const resetBtn1 = setupAudioControls('audio-1', 'play-1', 'next-1', 'Uitleg');
    document.getElementById('next-1').onclick = function() { 
      resetBtn1();
      showStep('step-2'); 
    };

    // Stap 2
    const resetBtn2 = setupAudioControls('audio-2', 'play-2', 'next-2', 'Methode');
    document.getElementById('next-2').onclick = function() { 
      resetBtn2();
      showStep('step-3'); 
    };

    // Stap 3 (zonder next-knop)
    setupAudioControls('audio-3', 'play-3', null, 'Oefening');

    // Stap 3 extra logica voor herhalingen
    const audio3 = document.getElementById('audio-3');
    const btn3 = document.getElementById('play-3');
    function setBtn3Text(state) {
      btn3.querySelector('span').textContent = (
        state === 'default' ? 'Oefening' :
        state === 'playing' ? 'Pauze' :
        state === 'paused' ? 'Verder' : 'Opnieuw'
      );
    }
    setBtn3Text('default');
    btn3.disabled = false;
    updateCount();

    audio3.onended = function() {
      step3Count++;
      localStorage.setItem('step3Count', step3Count);
      updateCount();
      setBtn3Text('ended');
      btn3.disabled = false;
      btn3.querySelector('.progress-bar').style.width = '100%';
      if (step3Count >= 3) showStep('evaluation-step'); else showStep('step-3');
    };

    // Evaluation fallback hides form on click
    document.getElementById('fallback-link').onclick = function() {
      localStorage.setItem('evaluated','true');
      showStep('step-3');
    };
  });
</script>
</body>
</html>